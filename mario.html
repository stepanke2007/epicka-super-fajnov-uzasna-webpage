<!DOCTYPE html>
<html lang="cs">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Block Jump</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #5c94fc;
            /* Mario Sky Blue */
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            overflow: hidden;
        }

        canvas {
            display: block;
            background-color: #5c94fc;
        }

        #ui-layer {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            font-size: 24px;
            font-weight: bold;
            text-shadow: 2px 2px 0 #000;
        }

        #controls-hint {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            color: #fff;
            font-size: 16px;
            text-shadow: 1px 1px 0 rgba(0, 0, 0, 0.5);
            opacity: 0.8;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body>

    <div id="game-container">
        <canvas id="gameCanvas" width="800" height="600"></canvas>
        <div id="ui-layer">
            SCORE: <span id="score">0</span>
        </div>
        <div id="controls-hint">Pohyb: Šipky | R: Restart</div>
    </div>

    <script>
        /**
         * GAME ENGINE & LOGIC
         */
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');

        // Game Constants
        const GRAVITY = 0.5;
        const FRICTION = 0.8;
        const MOVE_SPEED = 5;
        const JUMP_FORCE = 12;

        // Game State
        let score = 0;
        let gameOver = false;
        let cameraX = 0;

        // Input Handling
        const keys = {
            ArrowRight: false,
            ArrowLeft: false,
            ArrowUp: false
        };

        document.addEventListener('keydown', (e) => {
            if (keys.hasOwnProperty(e.code)) keys[e.code] = true;
            if (e.code === 'KeyR') resetGame();
        });

        document.addEventListener('keyup', (e) => {
            if (keys.hasOwnProperty(e.code)) keys[e.code] = false;
        });

        // --- CLASSES ---

        class Box {
            constructor(x, y, width, height, color, type = 'solid') {
                this.x = x;
                this.y = y;
                this.width = width;
                this.height = height;
                this.color = color;
                this.type = type; // solid, coin, win, lava
                this.active = true;
            }

            draw(ctx, camX) {
                if (!this.active) return;
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - camX, this.y, this.width, this.height);

                // Debug decoration
                ctx.strokeStyle = "rgba(0,0,0,0.1)";
                ctx.strokeRect(this.x - camX, this.y, this.width, this.height);
            }
        }

        class Player {
            constructor(x, y) {
                this.startX = x;
                this.startY = y;
                this.x = x;
                this.y = y;
                this.width = 32;
                this.height = 32;
                this.vx = 0;
                this.vy = 0;
                this.isGrounded = false;
                this.color = '#e52521'; // Mario Red
            }

            update() {
                // Apply Gravity
                this.vy += GRAVITY;

                // Horizontal Movement
                if (keys.ArrowRight) this.vx += 1;
                if (keys.ArrowLeft) this.vx -= 1;

                // Friction / Max Speed Cap
                this.vx *= FRICTION;

                // Move X
                this.x += this.vx;
                this.checkCollisions('x');

                // Move Y
                this.y += this.vy;
                this.isGrounded = false; // Assume in air until collision proves otherwise
                this.checkCollisions('y');

                // Jumping
                if (keys.ArrowUp && this.isGrounded) {
                    this.vy = -JUMP_FORCE;
                    this.isGrounded = false;
                }

                // Fall off world
                if (this.y > canvas.height) {
                    resetGame();
                }
            }

            checkCollisions(axis) {
                for (let block of platforms) {
                    if (!block.active) continue;

                    // Simple AABB Collision
                    if (this.x < block.x + block.width &&
                        this.x + this.width > block.x &&
                        this.y < block.y + block.height &&
                        this.y + this.height > block.y) {

                        // Interaction based on block type
                        if (block.type === 'coin') {
                            block.active = false;
                            score += 100;
                            scoreElement.innerText = score;
                            return; // No physical collision response for coins
                        } else if (block.type === 'win') {
                            alert("VÍTĚZSTVÍ! Dosáhl jsi cíle!");
                            resetGame();
                            return;
                        } else if (block.type === 'lava') {
                            resetGame();
                            return;
                        }

                        // Physical Collision Response (Solid blocks)
                        if (axis === 'x') {
                            // Moving Right
                            if (this.vx > 0) this.x = block.x - this.width;
                            // Moving Left
                            else if (this.vx < 0) this.x = block.x + block.width;
                            this.vx = 0;
                        } else {
                            // Falling Down
                            if (this.vy > 0) {
                                this.y = block.y - this.height;
                                this.isGrounded = true;
                                this.vy = 0;
                            }
                            // Jumping Up
                            else if (this.vy < 0) {
                                this.y = block.y + block.height;
                                this.vy = 0;
                            }
                        }
                    }
                }
            }

            draw(ctx, camX) {
                ctx.fillStyle = this.color;
                ctx.fillRect(this.x - camX, this.y, this.width, this.height);

                // Eyes (Mario style simple face)
                ctx.fillStyle = 'white';
                const dir = this.vx >= 0 ? 1 : -1;
                ctx.fillRect(this.x - camX + (dir > 0 ? 20 : 4), this.y + 6, 4, 8); // Eye

                // Hat rim
                ctx.fillStyle = '#b31512';
                ctx.fillRect(this.x - camX - 2, this.y, this.width + 4, 6);
            }
        }

        // --- LEVEL DESIGN ---
        let player;
        let platforms = [];

        function initLevel() {
            score = 0;
            scoreElement.innerText = score;
            platforms = [];

            // Block Types Helper
            const ground = (x, y, w) => new Box(x, y, w, 40, '#654030'); // Dirt brown
            const grass = (x, y, w) => new Box(x, y, w, 10, '#16a34a'); // Green top
            const brick = (x, y) => new Box(x, y, 40, 40, '#cd5c5c');
            const pipe = (x, y, h) => new Box(x, y, 50, h, '#22c55e');
            const coin = (x, y) => new Box(x + 10, y + 10, 20, 20, '#fbbf24', 'coin');
            const finish = (x, y) => new Box(x, y, 40, 300, '#fbbf24', 'win');

            // --- LEVEL MAP ---

            // Start Area
            platforms.push(ground(0, 500, 600));
            platforms.push(grass(0, 500, 600));

            // Question mark blocks / Bricks
            platforms.push(brick(300, 350));
            platforms.push(coin(300, 300)); // Coin above brick

            platforms.push(brick(340, 350));
            platforms.push(brick(380, 350));
            platforms.push(coin(340, 200)); // High coin

            // Pipe Jump
            platforms.push(pipe(500, 440, 60));

            // Gap
            platforms.push(ground(700, 500, 400));
            platforms.push(grass(700, 500, 400));

            // Floating platforms
            platforms.push(brick(850, 350));
            platforms.push(brick(1000, 250));
            platforms.push(coin(1000, 200));

            // Big Gap
            platforms.push(ground(1250, 500, 200));
            platforms.push(grass(1250, 500, 200));

            // Staircase
            for (let i = 0; i < 5; i++) {
                platforms.push(brick(1600 + i * 40, 500 - i * 40));
            }

            // Final Platform
            platforms.push(ground(1800, 500, 500));
            platforms.push(grass(1800, 500, 500));

            // Finish Line
            platforms.push(finish(2200, 200));

            // Initialize Player
            player = new Player(50, 400);
        }

        function resetGame() {
            initLevel();
        }

        // --- MAIN LOOP ---
        function update() {
            player.update();

            // Camera Follow Logic (Keep player somewhat centered)
            let targetCamX = player.x - 200;
            // Clamp camera so it doesn't show negative space
            if (targetCamX < 0) targetCamX = 0;

            // Smooth camera lerp
            cameraX += (targetCamX - cameraX) * 0.1;
        }

        function draw() {
            // Clear Screen
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // Draw Platforms & Coins
            platforms.forEach(p => p.draw(ctx, cameraX));

            // Draw Player
            player.draw(ctx, cameraX);

            // Draw Ground Line decorative (infinite look)
            ctx.fillStyle = '#5c94fc'; // Redraw sky if needed or parallax clouds could go here
        }

        function loop() {
            update();
            draw();
            requestAnimationFrame(loop);
        }

        // Start
        initLevel();
        loop();

    </script>
</body>

</html>